{"$schema": "https://www.speedscope.app/file-format-schema.json", "name": "CPU profile for /usr/local/bin/pyinstrument bin/mha2sha-onnx-converter --model-name llama-ar64-1-of-4 --exported-model-encoding-path /local/mnt2/workspace/ernst/workspace-for-genai/llama-ar64/artifacts/0429_llamav2-ar64-kv/split_onnx/0429_llamav2_ar64_kv_1_of_4.encodings --exported-model-path /local/mnt2/workspace/ernst/workspace-for-genai/llama-ar64/artifacts/0429_llamav2-ar64-kv/split_onnx/0429_llamav2_ar64_kv_1_of_4.onnx --handle-rope-ops --replace-linear-with-conv --sha-export-path ./sha-exports/llama-ar64 --no-verification at 2024-05-15T14-06-17", "activeProfileIndex": null, "exporter": "pyinstrument", "profiles": [{"type": "evented", "name": "CPU profile for /usr/local/bin/pyinstrument bin/mha2sha-onnx-converter --model-name llama-ar64-1-of-4 --exported-model-encoding-path /local/mnt2/workspace/ernst/workspace-for-genai/llama-ar64/artifacts/0429_llamav2-ar64-kv/split_onnx/0429_llamav2_ar64_kv_1_of_4.encodings --exported-model-path /local/mnt2/workspace/ernst/workspace-for-genai/llama-ar64/artifacts/0429_llamav2-ar64-kv/split_onnx/0429_llamav2_ar64_kv_1_of_4.onnx --handle-rope-ops --replace-linear-with-conv --sha-export-path ./sha-exports/llama-ar64 --no-verification at 2024-05-15T14-06-17", "unit": "seconds", "startValue": 0.0, "endValue": 113.62792873382568, "events": [{"type": "O", "at": 0.0, "frame": 0}, {"type": "O", "at": 0.0, "frame": 1}, {"type": "C", "at": 1.444606537988875, "frame": 1}, {"type": "O", "at": 1.444606537988875, "frame": 2}, {"type": "O", "at": 1.444606537988875, "frame": 3}, {"type": "O", "at": 1.444606537988875, "frame": 4}, {"type": "O", "at": 1.444606537988875, "frame": 5}, {"type": "O", "at": 1.444606537988875, "frame": 6}, {"type": "C", "at": 10.566218240084709, "frame": 6}, {"type": "C", "at": 10.568209379081964, "frame": 5}, {"type": "C", "at": 10.570802494083182, "frame": 4}, {"type": "C", "at": 10.572422594079399, "frame": 3}, {"type": "C", "at": 10.572422594079399, "frame": 2}, {"type": "O", "at": 10.572422594079399, "frame": 7}, {"type": "O", "at": 10.572422594079399, "frame": 8}, {"type": "O", "at": 10.572422594079399, "frame": 9}, {"type": "O", "at": 10.572422594079399, "frame": 10}, {"type": "O", "at": 10.572422594079399, "frame": 11}, {"type": "C", "at": 12.095276434076368, "frame": 11}, {"type": "C", "at": 12.102008825080702, "frame": 10}, {"type": "C", "at": 12.10482201607374, "frame": 9}, {"type": "C", "at": 12.10482201607374, "frame": 8}, {"type": "O", "at": 12.10482201607374, "frame": 12}, {"type": "O", "at": 12.10482201607374, "frame": 13}, {"type": "O", "at": 12.10482201607374, "frame": 14}, {"type": "C", "at": 13.436158848082414, "frame": 14}, {"type": "O", "at": 13.436158848082414, "frame": 14}, {"type": "C", "at": 15.02264376009407, "frame": 14}, {"type": "O", "at": 15.02264376009407, "frame": 14}, {"type": "C", "at": 16.572463017102564, "frame": 14}, {"type": "O", "at": 16.572463017102564, "frame": 14}, {"type": "C", "at": 18.71158089110395, "frame": 14}, {"type": "O", "at": 18.71158089110395, "frame": 14}, {"type": "C", "at": 21.133929092116887, "frame": 14}, {"type": "O", "at": 21.133929092116887, "frame": 15}, {"type": "O", "at": 21.133929092116887, "frame": 16}, {"type": "O", "at": 21.133929092116887, "frame": 17}, {"type": "O", "at": 21.133929092116887, "frame": 18}, {"type": "O", "at": 21.133929092116887, "frame": 19}, {"type": "C", "at": 22.405670913110953, "frame": 19}, {"type": "C", "at": 22.490603988117073, "frame": 18}, {"type": "C", "at": 22.5027579361049, "frame": 17}, {"type": "C", "at": 22.5027579361049, "frame": 16}, {"type": "O", "at": 22.5027579361049, "frame": 16}, {"type": "O", "at": 22.5027579361049, "frame": 17}, {"type": "O", "at": 22.5027579361049, "frame": 18}, {"type": "O", "at": 22.5027579361049, "frame": 19}, {"type": "C", "at": 23.7688728931098, "frame": 19}, {"type": "C", "at": 23.85317236209812, "frame": 18}, {"type": "C", "at": 23.8641911381128, "frame": 17}, {"type": "C", "at": 23.8641911381128, "frame": 16}, {"type": "O", "at": 23.8641911381128, "frame": 16}, {"type": "O", "at": 23.8641911381128, "frame": 17}, {"type": "O", "at": 23.8641911381128, "frame": 18}, {"type": "O", "at": 23.8641911381128, "frame": 19}, {"type": "C", "at": 25.12624207312183, "frame": 19}, {"type": "C", "at": 25.209628618118586, "frame": 18}, {"type": "C", "at": 25.21998515611631, "frame": 17}, {"type": "C", "at": 25.21998515611631, "frame": 16}, {"type": "O", "at": 25.21998515611631, "frame": 16}, {"type": "O", "at": 25.21998515611631, "frame": 17}, {"type": "O", "at": 25.21998515611631, "frame": 18}, {"type": "O", "at": 25.21998515611631, "frame": 19}, {"type": "C", "at": 26.482528924112557, "frame": 19}, {"type": "C", "at": 26.566034142117132, "frame": 18}, {"type": "C", "at": 26.58055020410393, "frame": 17}, {"type": "C", "at": 26.58055020410393, "frame": 16}, {"type": "O", "at": 26.58055020410393, "frame": 16}, {"type": "O", "at": 26.58055020410393, "frame": 17}, {"type": "O", "at": 26.58055020410393, "frame": 18}, {"type": "O", "at": 26.58055020410393, "frame": 19}, {"type": "C", "at": 27.840246146108257, "frame": 19}, {"type": "C", "at": 27.92593502710224, "frame": 18}, {"type": "C", "at": 27.93846109911101, "frame": 17}, {"type": "C", "at": 27.93846109911101, "frame": 16}, {"type": "O", "at": 27.93846109911101, "frame": 16}, {"type": "O", "at": 27.93846109911101, "frame": 17}, {"type": "O", "at": 27.93846109911101, "frame": 18}, {"type": "O", "at": 27.93846109911101, "frame": 19}, {"type": "C", "at": 29.201837984102895, "frame": 19}, {"type": "C", "at": 29.286617964113248, "frame": 18}, {"type": "C", "at": 29.301945364117273, "frame": 17}, {"type": "C", "at": 29.301945364117273, "frame": 16}, {"type": "O", "at": 29.301945364117273, "frame": 16}, {"type": "O", "at": 29.301945364117273, "frame": 17}, {"type": "O", "at": 29.301945364117273, "frame": 18}, {"type": "O", "at": 29.301945364117273, "frame": 19}, {"type": "C", "at": 30.564018216115073, "frame": 19}, {"type": "C", "at": 30.648889921110822, "frame": 18}, {"type": "C", "at": 30.66075947912759, "frame": 17}, {"type": "C", "at": 30.66075947912759, "frame": 16}, {"type": "O", "at": 30.66075947912759, "frame": 16}, {"type": "O", "at": 30.66075947912759, "frame": 17}, {"type": "O", "at": 30.66075947912759, "frame": 18}, {"type": "O", "at": 30.66075947912759, "frame": 19}, {"type": "C", "at": 31.924346981133567, "frame": 19}, {"type": "C", "at": 32.009243092135875, "frame": 18}, {"type": "C", "at": 32.020703452129965, "frame": 17}, {"type": "C", "at": 32.020703452129965, "frame": 16}, {"type": "C", "at": 60.61758520737931, "frame": 15}, {"type": "O", "at": 60.61758520737931, "frame": 20}, {"type": "O", "at": 60.61758520737931, "frame": 21}, {"type": "O", "at": 60.61758520737931, "frame": 22}, {"type": "C", "at": 62.07226971637283, "frame": 22}, {"type": "C", "at": 62.24687786141294, "frame": 21}, {"type": "C", "at": 62.27096288642497, "frame": 20}, {"type": "C", "at": 66.49845020438079, "frame": 13}, {"type": "O", "at": 66.49845020438079, "frame": 23}, {"type": "O", "at": 66.49845020438079, "frame": 24}, {"type": "O", "at": 66.49845020438079, "frame": 25}, {"type": "O", "at": 66.49845020438079, "frame": 26}, {"type": "O", "at": 66.49845020438079, "frame": 27}, {"type": "C", "at": 69.13951076137892, "frame": 27}, {"type": "C", "at": 69.13951076137892, "frame": 26}, {"type": "C", "at": 69.13951076137892, "frame": 25}, {"type": "C", "at": 69.54035223038227, "frame": 24}, {"type": "O", "at": 69.54035223038227, "frame": 28}, {"type": "O", "at": 69.54035223038227, "frame": 29}, {"type": "O", "at": 69.54035223038227, "frame": 30}, {"type": "O", "at": 69.54035223038227, "frame": 29}, {"type": "O", "at": 69.54035223038227, "frame": 30}, {"type": "O", "at": 69.54035223038227, "frame": 29}, {"type": "O", "at": 69.54035223038227, "frame": 31}, {"type": "C", "at": 88.7590841393685, "frame": 31}, {"type": "C", "at": 88.77507938136114, "frame": 29}, {"type": "C", "at": 88.77507938136114, "frame": 30}, {"type": "C", "at": 88.77507938136114, "frame": 29}, {"type": "C", "at": 88.77507938136114, "frame": 30}, {"type": "C", "at": 88.77507938136114, "frame": 29}, {"type": "C", "at": 89.23021345637972, "frame": 28}, {"type": "C", "at": 89.23021345637972, "frame": 23}, {"type": "O", "at": 89.23021345637972, "frame": 32}, {"type": "C", "at": 100.29789360547147, "frame": 32}, {"type": "O", "at": 100.29789360547147, "frame": 33}, {"type": "O", "at": 100.29789360547147, "frame": 34}, {"type": "O", "at": 100.29789360547147, "frame": 35}, {"type": "O", "at": 100.29789360547147, "frame": 22}, {"type": "C", "at": 103.01101901147922, "frame": 22}, {"type": "C", "at": 103.04180790047394, "frame": 35}, {"type": "O", "at": 103.04180790047394, "frame": 36}, {"type": "O", "at": 103.04180790047394, "frame": 37}, {"type": "C", "at": 123.32646838852088, "frame": 37}, {"type": "C", "at": 130.19968105852604, "frame": 36}, {"type": "C", "at": 130.57010326551972, "frame": 34}, {"type": "C", "at": 130.60305835551117, "frame": 33}, {"type": "C", "at": 130.89625454653287, "frame": 12}, {"type": "C", "at": 130.943931510541, "frame": 7}, {"type": "C", "at": 131.0263006475434, "frame": 0}]}], "shared": {"frames": [{"name": "<module>", "file": "bin/mha2sha-onnx-converter", "line": 18}, {"name": "<module>", "file": "/local/mnt2/workspace/ernst/mha2sha/src/python/mha2sha/converter.py", "line": 17}, {"name": "__init__", "file": "/local/mnt2/workspace/ernst/mha2sha/src/python/mha2sha/converter.py", "line": 103}, {"name": "get_model_loader", "file": "/local/mnt2/workspace/ernst/mha2sha/src/python/mha2sha/utils/onnx.py", "line": 63}, {"name": "load_model", "file": "/usr/local/lib/python3.8/dist-packages/onnx/__init__.py", "line": 151}, {"name": "load_external_data_for_model", "file": "/usr/local/lib/python3.8/dist-packages/onnx/external_data_helper.py", "line": 55}, {"name": "load_external_data_for_tensor", "file": "/usr/local/lib/python3.8/dist-packages/onnx/external_data_helper.py", "line": 32}, {"name": "convert", "file": "/local/mnt2/workspace/ernst/mha2sha/src/python/mha2sha/converter.py", "line": 168}, {"name": "_pattern_match", "file": "/local/mnt2/workspace/ernst/mha2sha/src/python/mha2sha/converter.py", "line": 378}, {"name": "auto_attention_finder", "file": "/local/mnt2/workspace/ernst/mha2sha/src/python/mha2sha/utils/auto_mha_finder.py", "line": 393}, {"name": "get_attn_info", "file": "/local/mnt2/workspace/ernst/mha2sha/src/python/mha2sha/utils/auto_mha_finder.py", "line": 218}, {"name": "verify_and_export_mha_info", "file": "/local/mnt2/workspace/ernst/mha2sha/src/python/mha2sha/utils/auto_mha_finder.py", "line": 178}, {"name": "_run_optimizations", "file": "/local/mnt2/workspace/ernst/mha2sha/src/python/mha2sha/converter.py", "line": 405}, {"name": "optimize", "file": "/local/mnt2/workspace/ernst/mha2sha/src/python/mha2sha/optimizer.py", "line": 1137}, {"name": "create_sha", "file": "/local/mnt2/workspace/ernst/mha2sha/src/python/mha2sha/optimizer.py", "line": 1033}, {"name": "replace", "file": "/local/mnt2/workspace/ernst/mha2sha/src/python/mha2sha/htp_optimizations/linear_to_conv.py", "line": 105}, {"name": "_get_htp_conv_from_linear", "file": "/local/mnt2/workspace/ernst/mha2sha/src/python/mha2sha/htp_optimizations/linear_to_conv.py", "line": 228}, {"name": "_get_conv_weight_bias_init", "file": "/local/mnt2/workspace/ernst/mha2sha/src/python/mha2sha/htp_optimizations/linear_to_conv.py", "line": 311}, {"name": "from_array", "file": "/usr/local/lib/python3.8/dist-packages/onnx/numpy_helper.py", "line": 274}, {"name": "ndarray.tobytes", "file": "<built-in>", "line": 0}, {"name": "topological_sort", "file": "/opt/qaisw-qnn/lib/python/qti/aisw/converters/onnx/onnx_model_api.py", "line": 1179}, {"name": "__graph_topological_sort", "file": "/opt/qaisw-qnn/lib/python/qti/aisw/converters/onnx/onnx_model_api.py", "line": 1098}, {"name": "[self]", "file": null, "line": null}, {"name": "mha_to_sha_encoding_mapping", "file": "/local/mnt2/workspace/ernst/mha2sha/src/python/mha2sha/optimizer.py", "line": 1319}, {"name": "load", "file": "/usr/lib/python3.8/json/__init__.py", "line": 274}, {"name": "loads", "file": "/usr/lib/python3.8/json/__init__.py", "line": 299}, {"name": "decode", "file": "/usr/lib/python3.8/json/decoder.py", "line": 332}, {"name": "raw_decode", "file": "/usr/lib/python3.8/json/decoder.py", "line": 343}, {"name": "map_encodings", "file": "/local/mnt2/workspace/ernst/mha2sha/src/python/mha2sha/encoding_mapper.py", "line": 38}, {"name": "deepcopy", "file": "/usr/lib/python3.8/copy.py", "line": 128}, {"name": "_deepcopy_dict", "file": "/usr/lib/python3.8/copy.py", "line": 226}, {"name": "_deepcopy_list", "file": "/usr/lib/python3.8/copy.py", "line": 200}, {"name": "dump", "file": "/usr/lib/python3.8/json/__init__.py", "line": 120}, {"name": "_save_model", "file": "/local/mnt2/workspace/ernst/mha2sha/src/python/mha2sha/converter.py", "line": 567}, {"name": "save_model", "file": "/usr/local/lib/python3.8/dist-packages/onnx/__init__.py", "line": 232}, {"name": "convert_model_to_external_data", "file": "/usr/local/lib/python3.8/dist-packages/onnx/external_data_helper.py", "line": 102}, {"name": "write_external_data_tensors", "file": "/usr/local/lib/python3.8/dist-packages/onnx/external_data_helper.py", "line": 295}, {"name": "save_external_data", "file": "/usr/local/lib/python3.8/dist-packages/onnx/external_data_helper.py", "line": 167}]}}
